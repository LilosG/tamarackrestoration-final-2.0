---
/**
 * ServicesGrid Component
 * ======================
 * Grid display of services with cards
 */

import Card from '@/components/ui/Card.astro';
import Icon from '@/components/ui/Icon.astro';
import Button from '@/components/ui/Button.astro';
import { services } from '@/data/site';
import type { Service } from '@/types';

interface Props {
  class?: string;
  title?: string;
  subtitle?: string;
  showAll?: boolean;
  limit?: number;
  featured?: string[]; // Array of service slugs to display
  columns?: 2 | 3;
  citySlug?: string; // If provided, links to city-specific pages
}

const { 
  class: className, 
  title = 'Emergency Restoration Services',
  subtitle = 'Professional restoration for any disaster',
  showAll = true,
  limit,
  featured,
  columns = 3,
  citySlug
} = Astro.props;

// Filter and limit services
let displayServices: Service[] = services;

if (featured && featured.length > 0) {
  displayServices = featured
    .map(slug => services.find(s => s.slug === slug))
    .filter((s): s is Service => s !== undefined);
} else if (limit) {
  displayServices = services.slice(0, limit);
}

// Generate href based on whether it's city-specific
function getServiceHref(service: Service): string {
  if (citySlug) {
    return `/service-area/${citySlug}/${service.slug}/`;
  }
  return `/services/${service.slug}/`;
}

const gridCols = columns === 2 
  ? 'md:grid-cols-2' 
  : 'md:grid-cols-2 lg:grid-cols-3';
---

<section class:list={['services-grid section bg-white', className]}>
  <div class="container">
    {(title || subtitle) && (
      <div class="text-center max-w-3xl mx-auto mb-12">
        {title && (
          <h2 class="font-display text-display-lg text-brand-black mb-4">
            {title}
          </h2>
        )}
        {subtitle && (
          <p class="text-body-lg text-brand-gray">
            {subtitle}
          </p>
        )}
      </div>
    )}
    
    <div class:list={['grid gap-6', gridCols]}>
      {displayServices.map((service) => (
        <Card 
          href={getServiceHref(service)} 
          padding="none" 
          class="group overflow-hidden"
        >
          <!-- Service Image -->
          <div class="aspect-card relative overflow-hidden bg-brand-cream-200">
            <img
              src={service.image}
              alt={service.name}
              class="w-full h-full object-cover transition-transform duration-slow group-hover:scale-105"
              loading="lazy"
              width="400"
              height="300"
            />
            {service.emergencyService && (
              <div class="absolute top-4 left-4">
                <span class="inline-flex items-center gap-1 px-2 py-1 bg-brand-orange text-white text-body-xs font-semibold rounded">
                  <Icon name="lightning" size="sm" />
                  24/7 Emergency
                </span>
              </div>
            )}
          </div>
          
          <!-- Service Content -->
          <div class="p-6">
            <div class="flex items-start gap-3 mb-3">
              <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-lg bg-brand-orange-100 text-brand-orange">
                <Icon name={service.icon} size="md" />
              </div>
              <h3 class="font-heading font-bold text-brand-black text-display-sm group-hover:text-brand-orange transition-colors">
                {service.name}
              </h3>
            </div>
            <p class="text-brand-gray text-body-md mb-4">
              {service.shortDescription}
            </p>
            <span class="inline-flex items-center gap-1 text-brand-orange font-semibold text-body-md group-hover:gap-2 transition-all">
              Learn More
              <Icon name="arrow-right" size="sm" />
            </span>
          </div>
        </Card>
      ))}
    </div>
    
    {showAll && !featured && (
      <div class="text-center mt-10">
        <Button href="/services/" variant="outline">
          View All Services
        </Button>
      </div>
    )}
  </div>
</section>
