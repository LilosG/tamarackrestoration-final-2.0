---
/**
 * ProjectCard Component
 * =====================
 * Displays a single project with before/after images,
 * service type badge, location, and description.
 * Supports before/after toggle on hover/tap.
 */

import Icon from './Icon.astro';
import { services, cities } from '@/data/site';
import type { Project } from '@/types';

interface Props {
  project: Project;
  variant?: 'default' | 'compact';
  class?: string;
}

const { project, variant = 'default', class: className } = Astro.props;

const service = services.find(s => s.slug === project.service);
const city = cities.find(c => c.slug === project.city);
const serviceName = service?.name || project.service;
const cityName = city?.name || project.city;
---

<div class:list={['project-card group relative', className]}>
  {variant === 'default' ? (
    <!-- Default variant: full card with image toggle -->
    <div class="bg-white rounded-2xl overflow-hidden shadow-soft hover:shadow-card transition-shadow">
      <!-- Before/After Image Container -->
      <div class="relative aspect-[4/3] overflow-hidden bg-brand-cream-300">
        <img
          src={project.afterImage}
          alt={`${project.title} - completed restoration in ${cityName}`}
          class="w-full h-full object-cover"
          loading="lazy"
        />
        <img
          src={project.beforeImage}
          alt={`${project.title} - before restoration in ${cityName}`}
          class="absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-500"
          loading="lazy"
        />

        <!-- Hover instruction -->
        <div class="absolute top-3 right-3 bg-brand-black/70 text-white text-xs px-3 py-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-sm">
          Before
        </div>
        <div class="absolute top-3 right-3 bg-brand-orange text-white text-xs px-3 py-1.5 rounded-full group-hover:opacity-0 transition-opacity">
          After
        </div>

        <!-- Service Badge -->
        <div class="absolute bottom-3 left-3">
          <span class="bg-brand-orange text-white text-xs font-semibold px-3 py-1.5 rounded-full">
            {serviceName}
          </span>
        </div>
      </div>

      <!-- Content -->
      <div class="p-5">
        <div class="flex items-center gap-2 text-brand-gray text-sm mb-2">
          <Icon name="map-pin" size="sm" class="text-brand-orange" />
          <span>{cityName}</span>
          <span class="text-brand-cream-400 mx-1">&middot;</span>
          <span>{project.completionDate}</span>
        </div>

        <h3 class="font-heading font-bold text-brand-black text-lg mb-2">
          {project.title}
        </h3>

        <p class="text-brand-gray text-sm leading-relaxed">
          {project.description}
        </p>
      </div>
    </div>
  ) : (
    <!-- Compact variant: smaller card for money pages -->
    <div class="bg-white rounded-xl overflow-hidden shadow-soft hover:shadow-card transition-shadow">
      <div class="relative aspect-video overflow-hidden bg-brand-cream-300">
        <img
          src={project.afterImage}
          alt={`${project.title} - completed restoration in ${cityName}`}
          class="w-full h-full object-cover"
          loading="lazy"
        />
        <img
          src={project.beforeImage}
          alt={`${project.title} - before restoration in ${cityName}`}
          class="absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-500"
          loading="lazy"
        />

        <div class="absolute top-2 right-2 bg-brand-black/70 text-white text-xs px-2 py-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-sm">
          Before
        </div>
        <div class="absolute top-2 right-2 bg-brand-orange text-white text-xs px-2 py-1 rounded-full group-hover:opacity-0 transition-opacity">
          After
        </div>

        <div class="absolute bottom-2 left-2">
          <span class="bg-brand-orange text-white text-xs font-semibold px-2 py-1 rounded-full">
            {serviceName}
          </span>
        </div>
      </div>

      <div class="p-4">
        <div class="flex items-center gap-1.5 text-brand-gray text-xs mb-1.5">
          <Icon name="map-pin" size="sm" class="text-brand-orange" />
          <span>{cityName}</span>
        </div>
        <h3 class="font-heading font-bold text-brand-black text-base mb-1.5">
          {project.title}
        </h3>
        <p class="text-brand-gray text-xs leading-relaxed line-clamp-3">
          {project.description}
        </p>
      </div>
    </div>
  )}
</div>
